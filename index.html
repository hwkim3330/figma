<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DesignFlow - Collaborative Design Tool</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
</head>
<body>
    <!-- Top Toolbar -->
    <div class="toolbar">
        <div class="toolbar-left">
            <h1 class="logo">DesignFlow</h1>
            <div class="tool-group">
                <button class="tool-btn active" data-tool="select" title="Select (V)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="rectangle" title="Rectangle (R)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="circle" title="Circle (O)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="line" title="Line (L)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="19" x2="19" y2="5"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="text" title="Text (T)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="4 7 4 4 20 4 20 7"/>
                        <line x1="9" y1="20" x2="15" y2="20"/>
                        <line x1="12" y1="4" x2="12" y2="20"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="triangle" title="Triangle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l10 20H2z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="star" title="Star (S)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="arrow" title="Arrow (A)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="19" x2="12" y2="5"/>
                        <polyline points="5 12 12 5 19 12"/>
                    </svg>
                </button>
                <div class="separator"></div>
                <!-- Diagram Shapes -->
                <button class="tool-btn" data-tool="diamond" title="Diamond (Decision)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l10 10-10 10L2 12z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="parallelogram" title="Parallelogram (Data)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 5h12l6 14H12z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="hexagon" title="Hexagon (Process)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l6 4v12l-6 4-6-4V6z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="cylinder" title="Cylinder (Database)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="cloud" title="Cloud">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"/>
                    </svg>
                </button>
                <button class="tool-btn" data-tool="connector" title="Connector">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
            </div>
            <div class="separator"></div>
            <!-- Layout Tools -->
            <div class="tool-group">
                <button class="icon-btn" id="align-left-btn" title="Align Left">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="15" y2="12"/>
                        <line x1="3" y1="18" x2="18" y2="18"/>
                    </svg>
                </button>
                <button class="icon-btn" id="align-center-btn" title="Align Center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="6" y1="12" x2="18" y2="12"/>
                        <line x1="5" y1="18" x2="19" y2="18"/>
                    </svg>
                </button>
                <button class="icon-btn" id="align-right-btn" title="Align Right">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="9" y1="12" x2="21" y2="12"/>
                        <line x1="6" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <button class="icon-btn" id="distribute-h-btn" title="Distribute Horizontally">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="8" width="4" height="8"/>
                        <rect x="10" y="8" width="4" height="8"/>
                        <rect x="17" y="8" width="4" height="8"/>
                    </svg>
                </button>
                <button class="icon-btn" id="distribute-v-btn" title="Distribute Vertically">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="8" y="3" width="8" height="4"/>
                        <rect x="8" y="10" width="8" height="4"/>
                        <rect x="8" y="17" width="8" height="4"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="toolbar-center">
            <button class="icon-btn" id="undo-btn" title="Undo (Ctrl+Z)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7v6h6"/>
                    <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
                </svg>
            </button>
            <button class="icon-btn" id="redo-btn" title="Redo (Ctrl+Y)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 7v6h-6"/>
                    <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
                </svg>
            </button>
            <div class="separator"></div>
            <button class="icon-btn" id="zoom-out-btn" title="Zoom Out (-)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                </svg>
            </button>
            <span class="zoom-level" id="zoom-level">100%</span>
            <button class="icon-btn" id="zoom-in-btn" title="Zoom In (+)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                    <line x1="11" y1="8" x2="11" y2="14"/>
                    <line x1="8" y1="11" x2="14" y2="11"/>
                </svg>
            </button>
            <button class="icon-btn" id="zoom-fit-btn" title="Fit to Screen">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-right">
            <div class="collab-section">
                <button class="btn-primary" id="share-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    Share
                </button>
                <div class="peer-info">
                    <span id="my-peer-id"></span>
                    <div id="connected-peers"></div>
                </div>
            </div>
            <button class="btn-primary" id="export-btn">Export</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Left Sidebar - Layers -->
        <div class="sidebar sidebar-left">
            <div class="sidebar-header">
                <h3>Layers</h3>
                <button class="icon-btn" id="delete-layer-btn" title="Delete Selected">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                    </svg>
                </button>
            </div>
            <div class="layers-panel" id="layers-panel">
                <!-- Layers will be dynamically added here -->
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            <div class="canvas-overlay" id="canvas-overlay"></div>
        </div>

        <!-- Right Sidebar - Properties -->
        <div class="sidebar sidebar-right">
            <div class="sidebar-header">
                <h3>Properties</h3>
            </div>
            <div class="properties-panel" id="properties-panel">
                <div class="property-group">
                    <label>Fill</label>
                    <div class="color-input-group">
                        <input type="color" id="fill-color" value="#0d99ff">
                        <input type="text" id="fill-color-text" value="#0d99ff">
                    </div>
                </div>
                <div class="property-group">
                    <label>Stroke</label>
                    <div class="color-input-group">
                        <input type="color" id="stroke-color" value="#333333">
                        <input type="text" id="stroke-color-text" value="#333333">
                    </div>
                    <label>Stroke Width</label>
                    <input type="range" id="stroke-width" min="0" max="20" value="1">
                    <span id="stroke-width-value">1px</span>
                </div>
                <div class="property-group" id="transform-group" style="display: none;">
                    <label>Position</label>
                    <div class="input-row">
                        <div class="input-with-label">
                            <span>X</span>
                            <input type="number" id="pos-x" value="0">
                        </div>
                        <div class="input-with-label">
                            <span>Y</span>
                            <input type="number" id="pos-y" value="0">
                        </div>
                    </div>
                    <label>Size</label>
                    <div class="input-row">
                        <div class="input-with-label">
                            <span>W</span>
                            <input type="number" id="size-w" value="0">
                        </div>
                        <div class="input-with-label">
                            <span>H</span>
                            <input type="number" id="size-h" value="0">
                        </div>
                    </div>
                    <label>Rotation</label>
                    <input type="range" id="rotation" min="0" max="360" value="0">
                    <span id="rotation-value">0Â°</span>
                    <label>Opacity</label>
                    <input type="range" id="opacity" min="0" max="100" value="100">
                    <span id="opacity-value">100%</span>
                    <label>Corner Radius</label>
                    <input type="range" id="corner-radius" min="0" max="100" value="0">
                    <span id="corner-radius-value">0px</span>
                </div>
                <div class="property-group" id="text-group" style="display: none;">
                    <label>Font Size</label>
                    <input type="range" id="font-size" min="8" max="200" value="32">
                    <span id="font-size-value">32px</span>
                    <label>Font Family</label>
                    <select id="font-family">
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Georgia">Georgia</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Design</h2>
                <button class="close-btn" id="close-share-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-section">
                    <label>Your Peer ID</label>
                    <div class="copy-input-group">
                        <input type="text" id="my-id-display" readonly />
                        <button class="btn-copy" id="copy-id-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
                <div class="share-section">
                    <label>Share Link</label>
                    <div class="copy-input-group">
                        <input type="text" id="share-url-display" readonly />
                        <button class="btn-copy" id="copy-url-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                            </svg>
                            Copy Link
                        </button>
                    </div>
                    <p class="share-hint">Anyone with this link can join your design session</p>
                </div>
                <div class="share-section">
                    <label>QR Code</label>
                    <div class="qr-container">
                        <canvas id="qr-canvas"></canvas>
                    </div>
                    <button class="btn-secondary" id="download-qr-btn">Download QR Code</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Design</h2>
                <button class="close-btn" id="close-export-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <button class="export-btn" id="export-png">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>Export as PNG</span>
                    </button>
                    <button class="export-btn" id="export-svg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>Export as SVG</span>
                    </button>
                    <button class="export-btn" id="export-json">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="12" y1="18" x2="12" y2="12"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                        <span>Save as JSON</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" id="ctx-copy">
            <span>Copy</span>
            <span class="shortcut">Ctrl+C</span>
        </div>
        <div class="context-menu-item" id="ctx-paste">
            <span>Paste</span>
            <span class="shortcut">Ctrl+V</span>
        </div>
        <div class="context-menu-item" id="ctx-duplicate">
            <span>Duplicate</span>
            <span class="shortcut">Ctrl+D</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="ctx-delete">
            <span>Delete</span>
            <span class="shortcut">Del</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="ctx-bring-front">
            <span>Bring to Front</span>
        </div>
        <div class="context-menu-item" id="ctx-send-back">
            <span>Send to Back</span>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
